<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ù…Ù‚Ø§Ø¨Ù„Ø© Ø´Ø®ØµÙŠØ© Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ â€“ AskTech</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{ request.url_for('static', path='style.css') }}"
    />
  </head>
  <body>
    <div class="background-orbs">
      <div class="orb orb-purple"></div>
      <div class="orb orb-pink"></div>
      <div class="orb orb-blue"></div>
    </div>

    <header class="top-navbar">
      <div class="navbar-content">
        <div class="navbar-brand">
          <span class="brand-logo">ğŸ¤–</span>
          <span class="brand-name">
            Ask<span class="brand-ai">Tech</span>
          </span>
        </div>
        <div class="navbar-actions">
          <button
            id="backToHomeBtn"
            class="eval-btn-nav"
            type="button"
            title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
          >
            <span class="eval-icon">â†</span>
            <span>Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
          </button>
        </div>
      </div>
    </header>

    <main class="chat-app video-interview-main">
      <div class="video-container-large">
        <div class="video-header-bar">
          <div class="video-title">
            <span class="video-title-icon">ğŸ¥</span>
            <span>Ù…Ù‚Ø§Ø¨Ù„Ø© Ø´Ø®ØµÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ</span>
          </div>
          <div class="video-status-badge">
            <span class="status-dot"></span>
            <span>Ù…ØªØµÙ„</span>
          </div>
        </div>

        <div class="video-meta">
          <div class="timer-pill">
            â±ï¸ <span id="interviewTimer">00:00</span>
          </div>
          <div class="progress-wrapper">
            <div class="progress-label">
              Ø§Ù„Ø³Ø¤Ø§Ù„ <span id="currentQuestionNumber">0</span> Ù…Ù† 
              <span id="totalQuestions">0</span>
            </div>
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
            </div>
          </div>
        </div>

        <div class="video-streams-large">
          <section class="video-stream-large interviewer-side">
            <div class="interviewer-video-feed">
              <div class="video-live-badge">
                <span class="live-dot"></span>
                <span>LIVE</span>
              </div>
              <div class="video-name-tag">
                <span class="name-icon">ğŸ¤–</span>
                <span>AskTech â€“ Ø§Ù„Ù…ÙÙ‚Ø§Ø¨ÙÙ„ Ø§Ù„Ø°ÙƒÙŠ</span>
              </div>
              <video
                class="interviewer-video"
                id="interviewerVideoFeed"
                autoplay
                muted
                loop
                playsinline
                webkit-playsinline
                moz-playsinline
              ></video>
            </div>
          </section>

          <section class="video-stream-large user-side">
            <div class="video-name-tag">
              <span class="name-icon">ğŸ™‹</span>
              <span>Ø£Ù†Øª</span>
            </div>
            <video
              id="userVideo"
              autoplay
              muted
              playsinline
              webkit-playsinline
              moz-playsinline
            ></video>
            <div class="video-label-large">
              ğŸ§‘â€ğŸ’¼ Ø¨Ø« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø´Ø®ØµÙŠØ©
            </div>
          </section>
        </div>

        <section class="transcript-panel">
          <div class="transcript-header">
            <span class="transcript-icon">ğŸ“</span>
            <span>Ù†Øµ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</span>
          </div>
          <div id="interviewTranscript" class="interview-transcript">
            <div class="t-row system">
              Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ø°Ù‡ Ù…Ø³Ø§Ø­Ø© Ø¹Ø±Ø¶ Ù†Øµ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©. Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙƒÙ„ Ù…Ø§ ØªÙ‚ÙˆÙ„Ù‡ Ø£Ù†Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©.
            </div>
          </div>
        </section>

        <section class="interview-controls-panel">
          <div class="interview-question-display" id="currentQuestion">
            <span class="question-icon">â“</span>
            <span>Ø§Ù†ØªØ¸Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©...</span>
          </div>
          <div class="interview-actions-bar">
            <button
              class="interview-btn-modern primary"
              id="startInterviewBtn"
              type="button"
            >
              <span class="btn-icon">â–¶ï¸</span>
              <span>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©</span>
            </button>
            <button
              class="interview-btn-modern danger"
              id="endInterviewBtn"
              type="button"
            >
              <span class="btn-icon">â¹</span>
              <span>Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©</span>
            </button>
          </fieldset>
        </section>
      </div>
    </main>

    <script>
      // Utility functions and variables
      const backBtn = document.getElementById("backToHomeBtn");
      if (backBtn) {
        backBtn.addEventListener("click", () => {
          window.location.href = "{{ request.url_for('home') }}";
        });
      }

      const startBtn = document.getElementById("startInterviewBtn");
      const endBtn = document.getElementById("endInterviewBtn");
      const transcriptEl = document.getElementById("interviewTranscript");
      const questionBox = document.getElementById("currentQuestion");
      const currentNumEl = document.getElementById("currentQuestionNumber");
      const totalNumEl = document.getElementById("totalQuestions");
      const progressFillEl = document.getElementById("progressFill");
      const timerEl = document.getElementById("interviewTimer");

      let questions = [];
      let currentIndex = 0;
      let interviewActive = false;
      let timerInterval = null;
      let startTime = null;
      let answersCount = 0;

      const questionTemplates = {
        "ØªØ¹Ù„ÙŠÙ…": [
          "Ù…Ø§ Ù‡ÙŠ ÙÙ„Ø³ÙØªÙƒ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆÙƒÙŠÙ ØªØ·Ø¨Ù‚Ù‡Ø§ ÙÙŠ Ø§Ù„ØµÙØŸ",
          "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©ØŸ",
          "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ø·Ù„Ø§Ø¨ØŸ",
          "ÙƒÙŠÙ ØªØ¯Ù…Ø¬ Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ØŸ",
          "ØµÙ Ù…ÙˆÙ‚ÙÙ‹Ø§ ØµØ¹Ø¨Ù‹Ø§ ÙˆØ§Ø¬Ù‡ØªÙ‡ ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ³ ÙˆÙƒÙŠÙ ØªØ¹Ø§Ù…Ù„Øª Ù…Ø¹Ù‡ØŸ",
          "Ù…Ø§ Ù‡ÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØªÙƒ Ù„ØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ØŸ",
          "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙØ±ÙˆÙ‚ Ø§Ù„ÙØ±Ø¯ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ø¨ØŸ"
        ],
        "ØµÙŠØ¯Ù„Ø©": [
          "Ù…Ø§ Ù‡ÙŠ Ø®Ø¨Ø±ØªÙƒ ÙÙŠ ØµØ±Ù Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ©ØŸ",
          "ÙƒÙŠÙ ØªÙˆØ§ÙƒØ¨ Ø£Ø­Ø¯Ø« Ø§Ù„ØªØ·ÙˆØ±Ø§Øª ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©ØŸ",
          "Ø§Ø´Ø±Ø­ ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©.",
          "ÙƒÙŠÙ ØªÙ‚Ø¯Ù… Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø¯ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ù…Ø±Ø¶Ù‰ØŸ",
          "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ¨Ø¹Ù‡Ø§ Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© ØµØ±Ù Ø§Ù„Ø¯ÙˆØ§Ø¡ØŸ",
          "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠØ©ØŸ",
          "Ù…Ø§ Ù‡ÙŠ Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„ØµÙŠØ¯Ù„Ø©ØŸ"
        ],
        "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": [
          "Ù…Ø§ Ù‡ÙŠ Ø®Ø¨Ø±ØªÙƒ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø´Ø¨ÙƒØ§ØªØŸ",
          "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØŸ",
          "Ø§Ø´Ø±Ø­ Ù…Ø´Ø±ÙˆØ¹Ù‹Ø§ ØªÙ‚Ù†ÙŠÙ‹Ø§ Ø¹Ù…Ù„Øª Ø¹Ù„ÙŠÙ‡ Ù…Ø¤Ø®Ø±Ù‹Ø§.",
          "Ù…Ø§ Ù‡ÙŠ Ù„ØºØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø£Ùˆ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙŠ ØªØªÙ‚Ù†Ù‡Ø§ØŸ",
          "ÙƒÙŠÙ ØªÙˆØ§ÙƒØ¨ Ø§Ù„ØªØ·ÙˆØ±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŸ",
          "ÙƒÙŠÙ ØªÙ†Ø¸Ù… Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„ Ù„ØªÙƒÙˆÙ† ÙØ¹Ø§Ù„Ø© ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ ITØŸ",
          "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ØªØ­Ø¯Ù ØªÙ‚Ù†ÙŠ ÙˆØ§Ø¬Ù‡ØªÙ‡ ÙˆÙƒÙŠÙ Ø­Ù„Ù„ØªÙ‡ØŸ"
        ],
        "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": [
          "Ù…Ø§ Ù‡ÙŠ Ø®Ø¨Ø±ØªÙƒ ÙÙŠ Ø¨Ù†Ø§Ø¡ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŸ",
          "Ø§Ø´Ø±Ø­ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚ ÙˆØ§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ.",
          "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø£Ùˆ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªÙŠ ØªÙØ¶Ù„Ù‡Ø§ ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŸ",
          "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…Ø´ÙƒÙ„Ø© overfitting ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ØŸ",
          "ØµÙ ØªØ·Ø¨ÙŠÙ‚Ù‹Ø§ Ø¹Ù…Ù„ÙŠÙ‹Ø§ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù‚Ù…Øª Ø¨ØªÙ†ÙÙŠØ°Ù‡.",
          "ÙƒÙŠÙ ØªØ®ØªØ§Ø± Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªÙ†Ø§Ø³Ø¨ Ù…Ø´Ø±ÙˆØ¹ÙƒØŸ",
          "Ù…Ø§ Ù‡ÙŠ Ø£Ù‡Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ§Ù„ØªÙŠ ØªØ«ÙŠØ± Ø§Ù‡ØªÙ…Ø§Ù…ÙƒØŸ"
        ]
      };

      const domainSynonyms = {
        "ØªØ¹Ù„ÙŠÙ…": ["ØªØ¹Ù„ÙŠÙ…","ØªØ¯Ø±ÙŠØ³","Ù…Ø¯Ø±Ø³Ø©","Ù…Ø¹Ù„Ù…","ØªØ±Ø¨ÙŠØ©"],
        "ØµÙŠØ¯Ù„Ø©": ["ØµÙŠØ¯Ù„Ø©","ØµÙŠØ¯Ù„ÙŠ","Ø¯ÙˆØ§Ø¡","Ø£Ø¯ÙˆÙŠØ©"],
        "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": ["ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª","Ù…Ø¹Ù„ÙˆÙ…Ø§Øª","Ø­Ø§Ø³Ø¨","ÙƒÙ…Ø¨ÙŠÙˆØªØ±","IT","ØªÙ‚Ù†ÙŠØ©"],
        "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": ["Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ","Ø°ÙƒØ§Ø¡ ØµÙ†Ø§Ø¹ÙŠ","AI","ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„Ø©"]
      };

      function appendTranscript(role, text) {
        const row = document.createElement("div");
        row.className = "t-row " + (role === 'user' ? 'user' : 'assistant');
        row.textContent = (role === 'user' ? 'ğŸ§‘: ' : 'ğŸ¤–: ') + text;
        transcriptEl.appendChild(row);
        transcriptEl.scrollTop = transcriptEl.scrollHeight;
      }

      function speakText(text, lang='ar-SA') {
        return new Promise(resolve => {
          const utter = new SpeechSynthesisUtterance(text);
          utter.lang = lang;
          utter.onend = () => resolve();
          window.speechSynthesis.speak(utter);
        });
      }

      function listenAnswer(timeoutMs = 40000) {
        return new Promise((resolve, reject) => {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          if (!SpeechRecognition) {
            return reject(new Error('Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­'));
          }
          const recognition = new SpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'ar-SA';
          recognition.maxAlternatives = 1;

          let answered = false;
          const timerId = setTimeout(() => {
            answered = true;
            recognition.stop();
            resolve(null);
          }, timeoutMs);

          recognition.onresult = (event) => {
            if (answered) return;
            clearTimeout(timerId);
            answered = true;
            recognition.stop();
            const text = event.results[0][0].transcript.trim();
            resolve(text);
          };

          recognition.onerror = (event) => {
            if (answered) return;
            clearTimeout(timerId);
            answered = true;
            recognition.stop();
            reject(new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª: ' + event.error));
          };

          recognition.onend = () => {
            if (!answered && interviewActive) {
              // Recognizer ended unexpectedly: restart it
              recognition.start();
            }
          };

          recognition.start();
        });
      }

      function shuffleArray(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function determineDomainFromText(text) {
        const lower = text.replace(/\s+/g,'').toLowerCase();
        for (const [key, syns] of Object.entries(domainSynonyms)) {
          for (const s of syns) {
            if (lower.includes(s.replace(/\s+/g,'').toLowerCase())) {
              return key;
            }
          }
        }
        return null;
      }

      function updateProgress() {
        currentNumEl.textContent = currentIndex + 1;
        totalNumEl.textContent = questions.length;
        const percent = ((currentIndex) / questions.length) * 100;
        progressFillEl.style.width = percent + '%';
      }

      function startTimer() {
        startTime = Date.now();
        timerEl.textContent = "00:00";
        timerInterval = setInterval(() => {
          const diff = Date.now() - startTime;
          const m = String(Math.floor(diff/60000)).padStart(2,'0');
          const s = String(Math.floor((diff%60000)/1000)).padStart(2,'0');
          timerEl.textContent = `${m}:${s}`;
        }, 1000);
      }

      function stopTimer() {
        clearInterval(timerInterval);
      }

      async function conductInterview(domainKey) {
        questions = shuffleArray(questionTemplates[domainKey]).slice(0,8);
        interviewActive = true;
        answersCount = 0;
        currentIndex = 0;
        startTimer();
        updateProgress();

        await speakText("Ø³Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ " + domainKey + ".");
        appendTranscript('assistant', "Ø³Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ " + domainKey + ".");

        while (interviewActive && currentIndex < questions.length) {
          updateProgress();
          const q = questions[currentIndex];
          questionBox.innerHTML = `<span class="question-icon">â“</span><span>${q}</span>`;
          await speakText(q);
          appendTranscript('assistant', q);

          try {
            const answer = await listenAnswer();
            if (answer !== null) {
              appendTranscript('user', answer);
              answersCount++;
            } else {
              appendTranscript('assistant', 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¥Ø¬Ø§Ø¨Ø© Ø¶Ù…Ù† Ø§Ù„Ù…Ù‡Ù„Ø©ØŒ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ.');
            }
          } catch(err) {
            appendTranscript('assistant', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª: ' + err.message);
          }

          currentIndex++;
        }

        stopTimer();
        interviewActive = false;

        const percent = Math.round((answersCount / questions.length) * 100);
        let evalMsg = "";
        if (percent === 100) {
          evalMsg = `Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²! Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ùª${percent}).`;
        } else if (percent >= 80) {
          evalMsg = `Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§. (Ùª${percent})`;
        } else if (percent >= 50) {
          evalMsg = `Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙˆØ³Ø·. (Ùª${percent})`;
        } else {
          evalMsg = `Ù†ÙˆØµÙŠ Ø¨Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø£ÙƒØ«Ø± Ù„Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©. (Ùª${percent}).`;
        }

        questionBox.innerHTML = `<span class="question-icon">âœ…</span><span>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©. ${evalMsg}</span>`;
        appendTranscript('assistant', "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©. " + evalMsg);
        await speakText("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©. " + evalMsg);
      }

      startBtn.addEventListener("click", async () => {
        if (interviewActive) return;
        transcriptEl.innerHTML = '';
        questionBox.innerHTML = `<span class="question-icon">â“</span><span>Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠÙ‡ØŸ</span>`;
        await speakText("Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠÙ‡ØŸ");
        appendTranscript('assistant', "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠÙ‡ØŸ");

        try {
          const speciality = await listenAnswer();
          appendTranscript('user', speciality);
          const domainKey = determineDomainFromText(speciality) || "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ";
          await conductInterview(domainKey);
        } catch(err) {
          appendTranscript('assistant', "Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø³Ù…Ø§Ø¹ Ø§Ù„ØªØ®ØµØµØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.");
          await speakText("Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø³Ù…Ø§Ø¹ Ø§Ù„ØªØ®ØµØµØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.");
          await conductInterview("Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ");
        }
      });

      endBtn.addEventListener("click", () => {
        if (!interviewActive) return;
        interviewActive = false;
        stopTimer();
        questionBox.innerHTML = `<span class="question-icon">âœ…</span><span>ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©.</span>`;
        appendTranscript('assistant', "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©.");
      });

      (async () => {
        const videoElement = document.getElementById("userVideo");
        if (!videoElement || !navigator.mediaDevices) return;
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
          videoElement.srcObject = stream;
        } catch (err) {
          console.error("Error accessing camera:", err);
        }
      })();
    </script>
  </body>
</html>
